{
    "settings": {
        "varpath": "data/"
    },
    "meta": {
        "name": "cp4s_1_6"
    },
    "blocks": [

        {
            "type": "kuectl.shell",
            "cmd": "echo \"IBM Entitlement key can be copied from: https://myibm.ibm.com/products-services/containerlibrary\"",

            "vars": {
                "entitlement-key": {
                    "type":"prompt",
                    "msg":"Enter your IBM Entitlement key"
                }
            }
        },

        {
            "type": "kubectl.shell",
            "cmd": "echo \"IBM Cloud Pak® for Security requires an FQDN see details here: https://www.ibm.com/support/knowledgecenter/SSTDPP_1.6.0/platform/docs/security-pak/install_chart.html\"",

            "vars": {
                "cp4s-fqdn": {
                    "type":"prompt",
                    "msg":"Enter your CP4S FQDN"
                }
            }
        },

        {
            "type": "kubectl.shell",
            "cmd": "echo \"IBM Cloud Pak® for Security requires a block StorageClass that only has RWO access see reference: https://www.ibm.com/docs/en/cloud-paks/cp-security/1.6.0?topic=planning-storage-requirements\"",

            "vars": {
                "cp4s-sc": {
                    "type":"prompt",
                    "msg":"Enter your StorageClass name"
                }
            }
        },

        {
            "type": "kubectl.shell",
            "cmd": "echo \"IBM Cloud Pak® for Security requires TLS certificates for the provided FQDN reference: https://www.ibm.com/docs/en/cloud-paks/cp-security/1.6.0?topic=planning-domain-name-tls-certificate\"",

            "vars": {
                "cp4s-tls-cert": {
                    "type":"prompt",
                    "msg":"Absolute path to tls.crt"
                }
            }
        },

        {
            "type": "kubectl.shell",
            "cmd": "echo \"IBM Cloud Pak® for Security requires TLS certificates for the provided FQDN reference: https://www.ibm.com/docs/en/cloud-paks/cp-security/1.6.0?topic=planning-domain-name-tls-certificate\"",

            "vars": {
                "cp4s-tls-key": {
                    "type":"prompt",
                    "msg":"Absolute path to tls.key"
                }
            }
        },

        {
            "type": "kubectl.shell",
            "cmd": "echo \"IBM Cloud Pak® for Security requires TLS certificates for the provided FQDN reference: https://www.ibm.com/docs/en/cloud-paks/cp-security/1.6.0?topic=planning-domain-name-tls-certificate\"",

            "vars": {
                "cp4s-tls-ca": {
                    "type":"prompt",
                    "msg":"Absolute path to ca.crt"
                }
            }
        },

        {
            "type": "kubectl.shell",
            "cmd": "wget %helm-cli-dl-url%"
        },

        {
            "type": "kubectl.shell",
            "cmd": "tar -xvf %helm-cli-tar%;"
        },

        {
            "type": "kubectl.shell",
            "cmd": "cp %helm-bin-name% /usr/local/bin/helm3"
        },

        {
            "type": "kubectl.shell",
            "cmd": "wget %cloudctl-cli-dl-url%"
        },

        {
            "type": "kubectl.shell",
            "cmd": "tar -xvf %cloudctl-cli-tar%"
        },

        {
            "type": "kubectl.shell",
            "cmd": "cp %cloudctl-bin-name% /usr/local/bin/cloudctl"
        },

        {
            "type": "kubectl.shell",
            "cmd": "cloudctl case save -t 1 --case https://github.com/IBM/cloud-pak/raw/master/repo/case/ibm-cp-security-1.0.15.tgz --outputdir ."
        },

        {
            "type": "kubectl.shell",
            "cmd": "tar -xf ./ibm/ibm-cp-security-1.0.15.tgz"
        },

        {
            "type": "config.write.yaml",
            "filepath": "./ibm-cp-security/inventory/installProduct/values.conf",
            "yamlpath": "$.cp4sapplicationDomain",
            "value": "%cp4s-fqdn%"
        },

        {
            "type": "config.write.yaml",
            "filepath": "./ibm-cp-security/inventory/installProduct/values.conf",
            "yamlpath": "$.cp4sdomainCertificatePath",
            "value": "%cp4s-tls-cert%"
        },

        {
            "type": "config.write.yaml",
            "filepath": "./ibm-cp-security/inventory/installProduct/values.conf",
            "yamlpath": "$.cp4sdomainCertificateKeyPath",
            "value": "%cp4s-tls-key%"
        },

        {
            "type": "config.write.yaml",
            "filepath": "./ibm-cp-security/inventory/installProduct/values.conf",
            "yamlpath": "$.cp4scustomcaFilepath",
            "value": "%cp4s-tls-ca%"
        },

        {
            "type": "config.write.yaml",
            "filepath": "./ibm-cp-security/inventory/installProduct/values.conf",
            "yamlpath": "$.entitledRegistryPassword",
            "value": "%entitlement-key%"
        },

        {
            "type": "config.write.yaml",
            "filepath": "./ibm-cp-security/inventory/installProduct/values.conf",
            "yamlpath": "$.storageClass",
            "value": "%cp4s-sc%"
        },

        {
            "type": "config.write.yaml",
            "filepath": "./ibm-cp-security/inventory/installProduct/values.conf",
            "yamlpath": "$.adminUserId",
            "value": "platform-admin"
        }
    ],

    "tests": [
        
    ]
}
